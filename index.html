<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VISION_OS - Neural Interface Terminal</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1 class="logo">VISION_OS <span class="version">v0.9.1</span></h1>
                <p class="subtitle">NEURAL INTERFACE TERMINAL // MEDIAPIPE</p>
            </div>
            <div class="header-right">
                <span class="live-indicator">
                    <span class="live-dot"></span>
                    LIVE
                </span>
                <span class="cpu-mem">CPU_MEM: <span id="cpuMem">0</span>%</span>
                <span class="wuji-controls">
                    <span class="wuji-label">WUJI</span>
                    <span id="wujiConn" class="wuji-conn disconnected">DISCONNECTED</span>
                    <span id="wujiHw" class="wuji-hw">HW:--</span>
                    <span class="wuji-vin">VIN <span id="wujiVin">--</span>V</span>
                    <select id="wujiSide" class="wuji-side" title="Which tracked hand controls the hardware hand">
                        <option value="auto">AUTO</option>
                        <option value="right">RIGHT</option>
                        <option value="left">LEFT</option>
                    </select>
                    <button id="wujiArmBtn" class="wuji-arm-btn" disabled>ARM</button>
                </span>
                <span class="time" id="currentTime">0:00:00 PM</span>
                <span class="timezone">UTC+08</span>
            </div>
        </header>

        <!-- Main Grid -->
        <main class="dashboard-grid">
            <!-- Optical Sensor (Webcam + Hand Tracking) -->
            <section class="panel optical-sensor">
                <div class="panel-header">
                    <span class="panel-title">OPTICAL_SENSOR_01</span>
                    <div class="view-controls">
                        <button class="view-btn active" id="btn2D">2D</button>
                        <button class="view-btn" id="btn3D">3D</button>
                    </div>
                    <span class="rec-indicator">
                        <span class="rec-dot"></span>
                        REC
                    </span>
                </div>
                <div class="video-container">
                    <div id="threeContainer">
                        <div class="three-overlay">
                            <span class="recon-text">3D_RECONSTRUCTION_ACTIVE</span>
                            <span class="recon-sub">BINAURAL_SPATIAL_MAPPING</span>
                        </div>
                    </div>
                    <video id="webcam" autoplay playsinline></video>
                    <canvas id="handCanvas"></canvas>
                    <div class="video-overlay">
                        <div class="fps-display">
                            <span class="label">FPS</span>
                            <span id="fpsValue">0</span>
                        </div>
                        <div class="hands-display">
                            <span class="label">HANDS</span>
                            <span id="handsCount">0</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Right Panel Stack -->
            <div class="right-panels">
                <!-- Finger Extension -->
                <section class="panel finger-extension">
                    <div class="panel-header">
                        <span class="panel-title">FINGER_EXTENSION</span>
                    </div>
                    <div class="dual-hand-container">
                        <!-- Left Hand Block -->
                        <div class="hand-block left" id="leftHandBlock">
                            <div class="hand-info-hud">
                                <div class="hud-item handedness">
                                    <span class="hud-label">SIDE</span>
                                    <span class="hud-value" id="leftHandSide">--</span>
                                </div>
                                <div class="hud-item position">
                                    <span class="hud-label">POS</span>
                                    <span class="hud-value" id="leftHandPos">X:0.0 Y:0.0</span>
                                </div>
                            </div>
                            <div class="finger-bars">
                                <div class="finger-bar">
                                    <div class="bar-container">
                                        <div class="bar-fill" id="leftThumbBar"></div>
                                    </div>
                                    <span class="finger-label">THM</span>
                                </div>
                                <div class="finger-bar">
                                    <div class="bar-container">
                                        <div class="bar-fill" id="leftIndexBar"></div>
                                    </div>
                                    <span class="finger-label">IDX</span>
                                </div>
                                <div class="finger-bar">
                                    <div class="bar-container">
                                        <div class="bar-fill" id="leftMiddleBar"></div>
                                    </div>
                                    <span class="finger-label">MID</span>
                                </div>
                                <div class="finger-bar">
                                    <div class="bar-container">
                                        <div class="bar-fill" id="leftRingBar"></div>
                                    </div>
                                    <span class="finger-label">RNG</span>
                                </div>
                                <div class="finger-bar">
                                    <div class="bar-container">
                                        <div class="bar-fill" id="leftPinkyBar"></div>
                                    </div>
                                    <span class="finger-label">PNK</span>
                                </div>
                            </div>
                        </div>

                        <!-- Right Hand Block -->
                        <div class="hand-block right" id="rightHandBlock">
                            <div class="hand-info-hud">
                                <div class="hud-item handedness">
                                    <span class="hud-label">SIDE</span>
                                    <span class="hud-value" id="rightHandSide">--</span>
                                </div>
                                <div class="hud-item position">
                                    <span class="hud-label">POS</span>
                                    <span class="hud-value" id="rightHandPos">X:0.0 Y:0.0</span>
                                </div>
                            </div>
                            <div class="finger-bars">
                                <div class="finger-bar">
                                    <div class="bar-container">
                                        <div class="bar-fill" id="rightThumbBar"></div>
                                    </div>
                                    <span class="finger-label">THM</span>
                                </div>
                                <div class="finger-bar">
                                    <div class="bar-container">
                                        <div class="bar-fill" id="rightIndexBar"></div>
                                    </div>
                                    <span class="finger-label">IDX</span>
                                </div>
                                <div class="finger-bar">
                                    <div class="bar-container">
                                        <div class="bar-fill" id="rightMiddleBar"></div>
                                    </div>
                                    <span class="finger-label">MID</span>
                                </div>
                                <div class="finger-bar">
                                    <div class="bar-container">
                                        <div class="bar-fill" id="rightRingBar"></div>
                                    </div>
                                    <span class="finger-label">RNG</span>
                                </div>
                                <div class="finger-bar">
                                    <div class="bar-container">
                                        <div class="bar-fill" id="rightPinkyBar"></div>
                                    </div>
                                    <span class="finger-label">PNK</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <div class="side-stack">
                    <!-- Orientation Compass -->
                    <section class="panel orientation-compass">
                        <div class="panel-header">
                            <span class="panel-title">ORIENTATION_COMPASS</span>
                        </div>
                        <div class="compass-container">
                            <canvas id="compassCanvas"></canvas>
                            <div class="heading-display">HDG <span id="headingValue">0</span>°</div>
                        </div>
                    </section>
                    <!-- Detected Gesture -->
                    <section class="panel detected-gesture">
                        <div class="panel-header">
                            <span class="panel-title">DETECTED_GESTURE</span>
                        </div>
                        <div class="gesture-content">
                            <div class="gesture-icon" id="gestureIcon">✋</div>
                            <div class="gesture-name" id="gestureName">NONE</div>
                        </div>
                    </section>

                    <!-- Wuji Hand Telemetry -->
                    <section class="panel wuji-telemetry">
                        <div class="panel-header">
                            <span class="panel-title">WUJI_TELEMETRY</span>
                        </div>
                        <div class="wuji-telemetry-content">
                            <div class="wuji-telemetry-row">
                                <span class="wuji-k">ARM</span>
                                <span class="wuji-v" id="wujiArmState">OFF</span>
                                <span class="wuji-k">VIN</span>
                                <span class="wuji-v"><span id="wujiVin2">--</span>V</span>
                            </div>
                            <div class="wuji-telemetry-row">
                                <span class="wuji-k">CMD</span>
                                <span class="wuji-v">TX <span id="wujiTx">0</span></span>
                                <span class="wuji-v">RX <span id="wujiRxHz">0</span>/s</span>
                                <span class="wuji-v">AGE <span id="wujiCmdAge">--</span>ms</span>
                            </div>
                            <div class="wuji-telemetry-row">
                                <span class="wuji-k">WS</span>
                                <input id="wujiUrl" class="wuji-url" type="text" spellcheck="false" />
                                <button id="wujiReconnectBtn" class="wuji-reconnect-btn" title="Force bridge reconnect now">RECONNECT</button>
                            </div>
                            <div class="wuji-telemetry-row">
                                <span class="wuji-k">CTRL</span>
                                <span class="wuji-v" id="wujiCtrlSide">RIGHT</span>
                                <span class="wuji-k">HZ</span>
                                <select id="wujiHz" class="wuji-hz" title="Send rate (Hz)">
                                    <option value="10">10</option>
                                    <option value="20" selected>20</option>
                                    <option value="30">30</option>
                                    <option value="60">60</option>
                                </select>
                            </div>
                            <div class="wuji-telemetry-row">
                                <span class="wuji-k">TEST</span>
                                <button id="wujiTestOpen" class="wuji-test-btn" title="Send OPEN pose to hardware">OPEN</button>
                                <button id="wujiTestFist" class="wuji-test-btn" title="Send FIST pose to hardware">FIST</button>
                                <button id="wujiResetBtn" class="wuji-test-btn" title="Recover from a jammed/gripped state: disable->enable->reset OPEN (4 fingers then thumb)">RESET</button>
                                <button id="wujiHardUnjamBtn" class="wuji-test-btn" title="HARD UNJAM: lower current limit + longer relax + reset OPEN (use when RESET can't open a stuck fist)">HARD UNJAM</button>
                            </div>
                            <pre id="wujiJoints" class="wuji-joints">--</pre>
                            <div id="wujiError" class="wuji-error"></div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Bottom Panels -->
            <!-- Signal Analysis -->
            <section class="panel signal-analysis">
                <div class="panel-header">
                    <span class="panel-title">ANALYSIS_OPEN</span>
                </div>
                <div class="signal-content">
                    <div class="pinch-header">
                        <span class="label">OPEN_LEVEL</span>
                        <span class="value" id="pinchValue">0.000</span>
                    </div>
                    <canvas id="signalCanvas"></canvas>
                    <div class="timer" id="timer">0:00</div>
                </div>
            </section>

            <!-- Neural Heatmap -->
            <section class="panel neural-heatmap">
                <div class="panel-header">
                    <span class="panel-title">NEURAL_HEATMAP</span>
                    <span class="heatmap-icon">▦</span>
                </div>
                <div class="heatmap-content">
                    <div class="heatmap-header">
                        <span class="label">SPATIAL_MAP</span>
                        <span class="active-label">ACTIVE: <span id="activeCount">0</span></span>
                    </div>
                    <div class="heatmap-grid" id="heatmapGrid"></div>
                </div>
            </section>
        </main>
    </div>

    <!-- MediaPipe Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="app.js"></script>
</body>

</html>